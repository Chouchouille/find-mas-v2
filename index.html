<style>
/* === CONTENEUR ZOOMABLE === */
.plan-zoom-wrapper {
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 100%;
    touch-action: none; /* important pour les gestes tactiles */
}

.zoom-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-origin: center center;
    transform: translate(-50%, -50%) scale(1);
    transition: transform 0.05s linear;
}

/* Ton style existant pour les numéros reste inchangé */
.number {
    position: absolute;
    color: white;
    font-size: 0;
    background-color: rgba(185, 184, 184, 0.5);
    padding: 0;
    border-radius: 5px;
    transform: translate(-50%, -50%);
    transition: background-color 0.1s ease, transform 0.1s ease, font-size 0.1s ease;
}

.number:hover {
    background-color: rgba(255, 255, 255, 0.7);
    transform: translate(-50%, -50%) scale(1.2);
    font-size: 14px;
}
</style>

<body>
    <!-- === PLAN === -->
    <div class="plan-container" id="planContainer">
        <div class="plan-zoom-wrapper" id="zoomWrapper">
            <div class="zoom-content" id="zoomContent">
                <img id="planImage" src="mas.jpg" alt="Plan MAS">
            </div>
        </div>
    </div>
</body>

<script>
/* === Variables globales === */
const zoomWrapper = document.getElementById("zoomWrapper");
const zoomContent = document.getElementById("zoomContent");
const planImage = document.getElementById("planImage");
let scale = 1, minScale = 1, maxScale = 5;
let startDistance = 0, lastScale = 1;
let panX = 0, panY = 0;
let lastPanX = 0, lastPanY = 0;
let isPanning = false, lastTouch = [];

/* === Données de numéros === */
const numbers = JSON.parse(localStorage.getItem("numbers")) || {};
function restoreNumbers() {
    for (const number in numbers) {
        const { xRatio, yRatio } = numbers[number];
        createNumberElement(number, xRatio, yRatio);
    }
}

function createNumberElement(number, xRatio, yRatio) {
    const el = document.createElement("div");
    el.classList.add("number");
    el.textContent = number;
    el.dataset.xRatio = xRatio;
    el.dataset.yRatio = yRatio;
    positionNumber(el);
    zoomContent.appendChild(el);
}

function positionNumber(el) {
    const rect = planImage.getBoundingClientRect();
    const xRatio = parseFloat(el.dataset.xRatio);
    const yRatio = parseFloat(el.dataset.yRatio);
    const x = xRatio * planImage.naturalWidth;
    const y = yRatio * planImage.naturalHeight;
    el.style.left = `${x}px`;
    el.style.top = `${y}px`;
}

/* === Fonction de mise à jour du zoom === */
function updateTransform() {
    zoomContent.style.transform = `translate(calc(-50% + ${panX}px), calc(-50% + ${panY}px)) scale(${scale})`;
}

/* === Gestion du pincement pour zoom === */
zoomWrapper.addEventListener("touchstart", e => {
    if (e.touches.length === 2) {
        startDistance = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );
        lastScale = scale;
    } else if (e.touches.length === 1) {
        isPanning = true;
        lastTouch = [e.touches[0].pageX, e.touches[0].pageY];
    }
});

zoomWrapper.addEventListener("touchmove", e => {
    e.preventDefault();
    if (e.touches.length === 2) {
        const newDistance = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );
        const scaleChange = newDistance / startDistance;
        scale = Math.min(maxScale, Math.max(minScale, lastScale * scaleChange));
        updateTransform();
    } else if (e.touches.length === 1 && isPanning) {
        const dx = e.touches[0].pageX - lastTouch[0];
        const dy = e.touches[0].pageY - lastTouch[1];
        panX += dx;
        panY += dy;
        lastTouch = [e.touches[0].pageX, e.touches[0].pageY];
        updateTransform();
    }
});

zoomWrapper.addEventListener("touchend", () => {
    isPanning = false;
});

/* === Zoom à la molette (desktop) === */
zoomWrapper.addEventListener("wheel", e => {
    e.preventDefault();
    const delta = e.deltaY > 0 ? -0.1 : 0.1;
    scale = Math.min(maxScale, Math.max(minScale, scale + delta));
    updateTransform();
});

/* === Chargement du plan === */
planImage.onload = () => {
    restoreNumbers();
    updateTransform();
};
</script>
