<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Rechercher MAS</title>

<style>
/* === STYLE GLOBAL === */
body {
    margin: 0;
    padding: 0;
    height: 100vh;
    overflow: hidden;
    background-color: #000;
    font-family: Arial, sans-serif;
}

/* === PLAN ZOOMABLE === */
.plan-zoom-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    touch-action: none;
}

.zoom-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-origin: center center;
    transform: translate(-50%, -50%) scale(1);
    transition: transform 0.05s linear;
}

.zoom-content img {
    max-width: none;
    -webkit-user-drag: none;
    user-select: none;
    touch-action: none;
}

/* === NUM√âROS === */
.number {
    position: absolute;
    color: white;
    font-size: 0;
    background-color: rgba(185, 184, 184, 0.5);
    padding: 0;
    border-radius: 5px;
    transform: translate(-50%, -50%);
    transition: background-color 0.1s ease, transform 0.1s ease, font-size 0.1s ease;
}
.number:hover {
    background-color: rgba(255, 255, 255, 0.7);
    transform: translate(-50%, -50%) scale(1.3);
    font-size: 14px;
}
.number.found {
    background-color: rgba(255, 0, 0, 0.7);
    transform: translate(-50%, -50%) scale(1.5);
    font-size: 18px;
}

/* === BARRES === */
.search-box, .password-box {
    position: fixed;
    top: 10px;
    left: 10px;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 10px;
    border-radius: 10px;
    color: white;
    border: 1px solid red;
    z-index: 1000;
}
.password-box {
    top: 90px;
}
.search-box input, .password-box input {
    padding: 5px;
    border-radius: 5px;
    border: none;
    width: 100px;
}
.search-box button, .password-box button {
    background-color: rgba(255,0,0,0.8);
    color: white;
    border: none;
    border-radius: 5px;
    padding: 5px 10px;
    margin-top: 5px;
    cursor: pointer;
}

/* === IMAGE AFFICH√âE === */
.image-container {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 200px;
    display: none;
    background: rgba(0,0,0,0.7);
    border: 2px solid red;
    border-radius: 10px;
    box-shadow: 0 0 10px red;
    z-index: 1000;
}
.image-container.show {
    display: block;
}
.image-container img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 10px;
}
.close-btn {
    position: absolute;
    top: 2px;
    right: 5px;
    color: white;
    background: rgba(0,0,0,0.6);
    border-radius: 5px;
    padding: 2px 5px;
    font-size: 12px;
}
</style>
</head>

<body>

<div class="plan-zoom-wrapper" id="zoomWrapper">
    <div class="zoom-content" id="zoomContent">
        <img id="planImage" src="mas.jpg" alt="Plan MAS">
    </div>
</div>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="N¬∞">
    <button onclick="searchNumber()">üîç</button>
</div>

<div class="password-box">
    <input type="password" id="passwordInput" placeholder="Mot de passe">
    <button onclick="validatePasswordFromField()">OK</button>
</div>

<div class="image-container" id="imageContainer">
    <span class="close-btn" onclick="closeImage()">X</span>
    <img id="imageDisplay" onclick="enlargeImage()">
</div>

<script>
/* === VARIABLES === */
const zoomWrapper = document.getElementById("zoomWrapper");
const zoomContent = document.getElementById("zoomContent");
const planImage = document.getElementById("planImage");

let scale = 1, minScale = 1, maxScale = 5;
let panX = 0, panY = 0;
let startDistance = 0, lastScale = 1;
let lastTouch = [], isPanning = false;

/* === NUM√âROS === */
const numbers = JSON.parse(localStorage.getItem("numbers")) || {};
restoreNumbers();

function restoreNumbers() {
    for (const number in numbers) {
        const { x, y } = numbers[number];
        createNumberElement(number, x, y);
    }
}

function createNumberElement(number, x, y) {
    const el = document.createElement("div");
    el.classList.add("number");
    el.textContent = number;
    el.style.left = `${x}px`;
    el.style.top = `${y}px`;
    el.addEventListener("click", e => {
        e.stopPropagation();
        if (isPasswordValid) {
            modifyOrDeleteNumber(number);
        } else {
            searchNumber(number);
        }
    });
    zoomContent.appendChild(el);
}

/* === ZOOM / PAN === */
function updateTransform() {
    zoomContent.style.transform = `translate(calc(-50% + ${panX}px), calc(-50% + ${panY}px)) scale(${scale})`;
}

zoomWrapper.addEventListener("touchstart", e => {
    if (e.touches.length === 2) {
        startDistance = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );
        lastScale = scale;
    } else if (e.touches.length === 1) {
        isPanning = true;
        lastTouch = [e.touches[0].pageX, e.touches[0].pageY];
    }
});

zoomWrapper.addEventListener("touchmove", e => {
    e.preventDefault();
    if (e.touches.length === 2) {
        const newDist = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );
        scale = Math.min(maxScale, Math.max(minScale, lastScale * (newDist / startDistance)));
        updateTransform();
    } else if (e.touches.length === 1 && isPanning) {
        const dx = e.touches[0].pageX - lastTouch[0];
        const dy = e.touches[0].pageY - lastTouch[1];
        panX += dx;
        panY += dy;
        lastTouch = [e.touches[0].pageX, e.touches[0].pageY];
        updateTransform();
    }
});
zoomWrapper.addEventListener("touchend", () => { isPanning = false; });

zoomWrapper.addEventListener("wheel", e => {
    e.preventDefault();
    scale += e.deltaY < 0 ? 0.1 : -0.1;
    scale = Math.min(maxScale, Math.max(minScale, scale));
    updateTransform();
});

/* === PASSWORD / RECHERCHE / IMAGE === */
const correctPassword = "17061977";
let isPasswordValid = false;

function validatePasswordFromField() {
    const val = document.getElementById("passwordInput").value;
    if (val === correctPassword) {
        isPasswordValid = true;
        alert("Mode √©dition activ√© !");
    } else {
        alert("Mot de passe incorrect !");
    }
}

function searchNumber(num) {
    const val = num || document.getElementById("searchInput").value.trim();
    document.querySelectorAll(".number").forEach(n => n.classList.remove("found"));
    const target = Array.from(document.querySelectorAll(".number")).find(el => el.textContent === val);
    if (target) {
        target.classList.add("found");
        displayImage(val);
    } else {
        alert("Num√©ro introuvable !");
    }
}

function displayImage(number) {
    const imgPath = `images/${number}.jpg`;
    const imageContainer = document.getElementById("imageContainer");
    document.getElementById("imageDisplay").src = imgPath;
    imageContainer.classList.add("show");
}

function closeImage() {
    document.getElementById("imageContainer").classList.remove("show");
}

function enlargeImage() {
    const src = document.getElementById("imageDisplay").src;
    window.open(src, "_blank");
}

function modifyOrDeleteNumber(number) {
    const action = prompt("1 = modifier, 2 = supprimer");
    if (action === "1") {
        const newNum = prompt("Nouveau num√©ro :");
        if (newNum) {
            numbers[newNum] = numbers[number];
            delete numbers[number];
            localStorage.setItem("numbers", JSON.stringify(numbers));
            location.reload();
        }
    } else if (action === "2") {
        delete numbers[number];
        localStorage.setItem("numbers", JSON.stringify(numbers));
        location.reload();
    }
}

planImage.onload = () => updateTransform();
</script>
</body>
</html>
