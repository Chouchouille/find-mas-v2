<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Plan MAS - Mobile</title>

<style>
/* === STYLE GLOBAL === */
body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #000;
  font-family: Arial, sans-serif;
}

/* === PLAN ZOOMABLE === */
.plan-zoom-wrapper {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  touch-action: none; /* essentiel pour les gestes tactiles */
}

.zoom-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: center center;
  transform: translate(-50%, -50%) scale(1);
}

.zoom-content img {
  max-width: none;
  -webkit-user-drag: none;
  user-select: none;
  touch-action: none;
}

/* === NUM√âROS === */
.number {
  position: absolute;
  color: white;
  font-size: 0;
  background-color: rgba(185, 184, 184, 0.5);
  padding: 0;
  border-radius: 5px;
  transform: translate(-50%, -50%);
  transition: background-color 0.1s ease, transform 0.1s ease, font-size 0.1s ease;
}
.number:hover {
  background-color: rgba(255, 255, 255, 0.7);
  transform: translate(-50%, -50%) scale(1.2);
  font-size: 14px;
}
.number.found {
  background-color: rgba(255, 0, 0, 0.8);
  transform: translate(-50%, -50%) scale(1.5);
  font-size: 16px;
}

/* === BO√éTES === */
.tools {
  position: fixed;
  top: 10px;
  left: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 1000;
}
.tools input, .tools button {
  padding: 6px 8px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
}
.tools button {
  background: red;
  color: white;
}

/* === IMAGE PR√âVIEW === */
.image-container {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: none;
  background: rgba(0,0,0,0.8);
  border: 2px solid red;
  border-radius: 10px;
  width: 200px;
  height: 200px;
  z-index: 1000;
}
.image-container.show { display: block; }
.image-container img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 10px;
}
.close-btn {
  position: absolute;
  top: 5px;
  right: 8px;
  color: white;
  font-size: 12px;
  background: rgba(0,0,0,0.5);
  border-radius: 5px;
  padding: 2px 5px;
}
</style>
</head>

<body>
<div class="plan-zoom-wrapper" id="zoomWrapper">
  <div class="zoom-content" id="zoomContent">
    <img id="planImage" src="mas.jpg" alt="Plan MAS">
  </div>
</div>

<div class="tools">
  <div>
    <input type="password" id="passwordInput" placeholder="Mot de passe">
    <button onclick="validatePassword()">OK</button>
  </div>
  <div>
    <input type="text" id="searchInput" placeholder="N¬∞">
    <button onclick="searchNumber()">üîç</button>
  </div>
</div>

<div class="image-container" id="imageContainer">
  <span class="close-btn" onclick="closeImage()">X</span>
  <img id="imageDisplay">
</div>

<script>
/* === VARIABLES === */
const zoomWrapper = document.getElementById("zoomWrapper");
const zoomContent = document.getElementById("zoomContent");
const planImage = document.getElementById("planImage");

let scale = 1, minScale = 1, maxScale = 5;
let panX = 0, panY = 0;
let startDistance = 0, lastScale = 1;
let lastTouch = [];
let isPanning = false;
let isPasswordValid = false;
let numbers = JSON.parse(localStorage.getItem("numbers")) || {};

/* === R√âCUP√âRATION DES NUM√âROS === */
function restoreNumbers() {
  for (const num in numbers) {
    const { xRatio, yRatio } = numbers[num];
    createNumber(num, xRatio, yRatio);
  }
}
function createNumber(num, xRatio, yRatio) {
  const el = document.createElement("div");
  el.classList.add("number");
  el.textContent = num;
  el.dataset.xRatio = xRatio;
  el.dataset.yRatio = yRatio;
  positionNumber(el);
  el.addEventListener("click", e => {
    e.stopPropagation();
    if (isPasswordValid) modifyOrDeleteNumber(num);
    else displayImage(num);
  });
  zoomContent.appendChild(el);
}
function positionNumber(el) {
  const rect = planImage.getBoundingClientRect();
  const x = el.dataset.xRatio * planImage.naturalWidth;
  const y = el.dataset.yRatio * planImage.naturalHeight;
  el.style.left = `${x}px`;
  el.style.top = `${y}px`;
}

/* === ZOOM ET PAN TACTILE === */
function updateTransform() {
  zoomContent.style.transform = `translate(calc(-50% + ${panX}px), calc(-50% + ${panY}px)) scale(${scale})`;
}
zoomWrapper.addEventListener("touchstart", e => {
  if (e.touches.length === 2) {
    startDistance = Math.hypot(
      e.touches[0].pageX - e.touches[1].pageX,
      e.touches[0].pageY - e.touches[1].pageY
    );
    lastScale = scale;
  } else if (e.touches.length === 1) {
    isPanning = true;
    lastTouch = [e.touches[0].pageX, e.touches[0].pageY];
  }
});
zoomWrapper.addEventListener("touchmove", e => {
  e.preventDefault();
  if (e.touches.length === 2) {
    const newDist = Math.hypot(
      e.touches[0].pageX - e.touches[1].pageX,
      e.touches[0].pageY - e.touches[1].pageY
    );
    const newScale = lastScale * (newDist / startDistance);
    scale = Math.min(maxScale, Math.max(minScale, newScale));
    updateTransform();
  } else if (e.touches.length === 1 && isPanning) {
    const dx = e.touches[0].pageX - lastTouch[0];
    const dy = e.touches[0].pageY - lastTouch[1];
    panX += dx;
    panY += dy;
    lastTouch = [e.touches[0].pageX, e.touches[0].pageY];
    updateTransform();
  }
});
zoomWrapper.addEventListener("touchend", () => (isPanning = false));

/* === ZOOM √Ä LA MOLETTE (PC) === */
zoomWrapper.addEventListener("wheel", e => {
  e.preventDefault();
  const delta = e.deltaY > 0 ? -0.1 : 0.1;
  scale = Math.min(maxScale, Math.max(minScale, scale + delta));
  updateTransform();
});

/* === AJOUT D‚ÄôUN NUM√âRO (mode √©dition) === */
zoomWrapper.addEventListener("click", e => {
  if (!isPasswordValid) return;
  const rect = planImage.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const xRatio = x / rect.width;
  const yRatio = y / rect.height;
  const newNum = prompt("Nouveau num√©ro :");
  if (newNum) {
    numbers[newNum] = { xRatio, yRatio };
    localStorage.setItem("numbers", JSON.stringify(numbers));
    createNumber(newNum, xRatio, yRatio);
  }
});

/* === MOT DE PASSE === */
function validatePassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === "17061977") {
    isPasswordValid = true;
    alert("Mode √©dition activ√© ‚úÖ");
  } else {
    alert("Mot de passe incorrect ‚ùå");
  }
}

/* === RECHERCHE / IMAGES === */
function searchNumber() {
  const val = document.getElementById("searchInput").value.trim();
  document.querySelectorAll(".number").forEach(n => n.classList.remove("found"));
  const target = Array.from(document.querySelectorAll(".number")).find(el => el.textContent === val);
  if (target) {
    target.classList.add("found");
    displayImage(val);
  } else alert("Num√©ro introuvable !");
}
function displayImage(num) {
  const img = document.getElementById("imageDisplay");
  const container = document.getElementById("imageContainer");
  img.src = `images/${num}.jpg`;
  container.classList.add("show");
}
function closeImage() {
  document.getElementById("imageContainer").classList.remove("show");
}

/* === SUPPRESSION / MODIF === */
function modifyOrDeleteNumber(num) {
  const choice = prompt("1 = modifier | 2 = supprimer");
  if (choice === "1") {
    const newNum = prompt("Nouveau num√©ro :");
    if (newNum) {
      numbers[newNum] = numbers[num];
      delete numbers[num];
      localStorage.setItem("numbers", JSON.stringify(numbers));
      location.reload();
    }
  } else if (choice === "2") {
    delete numbers[num];
    localStorage.setItem("numbers", JSON.stringify(numbers));
    location.reload();
  }
}

/* === INIT === */
planImage.onload = () => {
  restoreNumbers();
  updateTransform();
};
</script>
</body>
</html>
