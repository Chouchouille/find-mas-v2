<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Rechercher MAS</title>
<style>
  :root {
    --number-size: 18px;
  }

  body {
    margin: 0;
    height: 100vh;
    overflow: hidden;
    background: black;
    font-family: Arial, sans-serif;
    touch-action: none;
  }

  #introScreen {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle, #000000 0%, #200000 80%);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    animation: fadeIn 1s ease-in-out;
    cursor: pointer;
  }

  #introScreen h1 {
    font-size: 2rem;
    color: red;
    text-shadow: 0 0 15px red;
  }

  #introScreen p {
    font-size: 1rem;
    color: white;
    margin-top: 10px;
  }

  .progress-container {
    position: relative;
    width: 220px;
    height: 12px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 6px;
    overflow: hidden;
    margin-top: 25px;
    box-shadow: 0 0 10px rgba(255,0,0,0.3);
  }

  .progress-bar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #ff0000, #ff5050, #ff0000);
    background-size: 200% 100%;
    animation: progressMove 3s linear forwards, lightWave 1s linear infinite;
    border-radius: 6px;
  }

  @keyframes lightWave {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  @keyframes progressMove {
    from { width: 0%; }
    to { width: 100%; }
  }

  .progress-text {
    margin-top: 10px;
    font-size: 1rem;
    color: white;
    text-shadow: 0 0 10px red;
  }

  @keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; visibility: hidden; }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  #zoomContainer {
    position: relative;
    width: 100%;
    height: 100%;
    transform-origin: center center;
    background-image: url('mas.jpg');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    touch-action: none;
    transition: transform 0.1s linear;
  }

  .number {
    position: absolute;
    color: white;
    background-color: rgba(185, 184, 184, 0.6);
    padding: 1px 2px;
    border-radius: 2px;
    transform: translate(-50%, -50%);
    font-size: var(--number-size);
    transition: background 0.2s, color 0.2s, font-size 0.2s;
  }

  .number:hover {
    background: rgba(255,255,255,0.7);
  }

  .number.found {
    background: red !important;
    color: white !important;
    font-weight: bold;
    box-shadow: 0 0 12px red;
  }

  .search-box, .password-box, .size-box {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    color: white;
    border: 2px solid red;
    border-radius: 20px;
    padding: 10px;
    display: flex;
    gap: 5px;
    z-index: 10;
    align-items: center;
  }

  .search-box { top: 15px; }
  .password-box { top: 70px; }
  .size-box { top: 125px; display: none; }

  .search-box button, .password-box button {
    border-radius: 10px;
    background: red;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
  }

  input[type="range"] {
    accent-color: red;
  }
</style>
</head>
<body>

<div id="introScreen" onclick="hideIntro()">
  <h1>Bienvenue Xavier</h1>
  <p>Chargement en cours...</p>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="progress-text" id="progressText">0%</div>
</div>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Rechercher un num√©ro">
  <button onclick="searchNumber()">Rechercher</button>
  <button id="resetButton" onclick="resetNumbers()" style="background:darkred; display:none;">üóëÔ∏è Effacer tout</button>
</div>

<div class="password-box">
  <input type="password" id="passwordInput" placeholder="Mot de passe">
  <button onclick="validatePassword()">Valider</button>
</div>

<div class="size-box" id="sizeBox">
  <label for="sizeRange">Taille :</label>
  <input type="range" id="sizeRange" min="8" max="50" step="1">
  <span id="sizeValue"></span>
</div>

<div id="zoomContainer"></div>

<script>
/* === Intro === */
const progressText = document.getElementById("progressText");
let progress = 0;
const interval = setInterval(() => {
  if (progress < 100) {
    progress += 2;
    progressText.textContent = progress + "%";
  } else {
    progressText.textContent = "Pr√™t !";
    clearInterval(interval);
  }
}, 60);

function hideIntro() {
  const intro = document.getElementById("introScreen");
  intro.style.animation = "fadeOut 1s forwards";
  setTimeout(() => intro.remove(), 1000);
}
window.addEventListener("load", () => setTimeout(hideIntro, 3200));

/* === Taille === */
const sizeBox = document.getElementById("sizeBox");
const sizeRange = document.getElementById("sizeRange");
const sizeValue = document.getElementById("sizeValue");

const savedSize = localStorage.getItem("numberSize") || 18;
document.documentElement.style.setProperty("--number-size", savedSize + "px");
sizeRange.value = savedSize;
sizeValue.textContent = savedSize + "px";
sizeRange.addEventListener("input", () => {
  const val = sizeRange.value;
  document.documentElement.style.setProperty("--number-size", val + "px");
  sizeValue.textContent = val + "px";
  localStorage.setItem("numberSize", val);
});

/* === Mot de passe === */
const correctPassword = "17061977";
let isPasswordValid = false;
function validatePassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === correctPassword) {
    alert("Mot de passe correct ‚úÖ");
    isPasswordValid = true;
    document.getElementById("resetButton").style.display = "inline-block";
    sizeBox.style.display = "flex";
  } else {
    alert("Mot de passe incorrect ‚ùå");
  }
}

/* === Carte === */
const zoomContainer = document.getElementById("zoomContainer");
const numbers = JSON.parse(localStorage.getItem("numbers")) || {};
for (const n in numbers) createNumberElement(n, numbers[n].xPercent, numbers[n].yPercent);

function createNumberElement(number, xPercent, yPercent) {
  const el = document.createElement("div");
  el.classList.add("number");
  el.textContent = number;
  el.style.left = `${xPercent}%`;
  el.style.top = `${yPercent}%`;
  if (numbers[number].found) el.classList.add("found");
  zoomContainer.appendChild(el);
}

zoomContainer.addEventListener("click", (e) => {
  if (!isPasswordValid) return;
  const rect = zoomContainer.getBoundingClientRect();
  const xPercent = ((e.clientX - rect.left) / rect.width) * 100;
  const yPercent = ((e.clientY - rect.top) / rect.height) * 100;
  const num = prompt("Entrez un num√©ro :");
  if (num && !isNaN(num)) {
    numbers[num] = { xPercent, yPercent, found: false };
    localStorage.setItem("numbers", JSON.stringify(numbers));
    createNumberElement(num, xPercent, yPercent);
  }
});

function resetNumbers() {
  if (!isPasswordValid) return alert("Acc√®s refus√© ‚ùå");
  if (confirm("Supprimer tous les num√©ros ?")) {
    localStorage.removeItem("numbers");
    document.querySelectorAll(".number").forEach(el => el.remove());
  }
}

/* === Recherche persistante === */
function searchNumber() {
  const query = document.getElementById("searchInput").value.trim();
  if (!query) return;

  const allNumbers = document.querySelectorAll(".number");
  let found = null;
  allNumbers.forEach(num => {
    if (num.textContent === query) {
      num.classList.add("found");
      numbers[query].found = true;
      found = num;
    }
  });

  localStorage.setItem("numbers", JSON.stringify(numbers));

  if (found) {
    const rect = found.getBoundingClientRect();
    const containerRect = zoomContainer.getBoundingClientRect();
    const offsetX = (containerRect.width / 2) - (rect.left + rect.width / 2);
    const offsetY = (containerRect.height / 2) - (rect.top + rect.height / 2);
    currentTranslate.x += offsetX / currentScale;
    currentTranslate.y += offsetY / currentScale;
    updateTransform();
  } else {
    alert("Num√©ro introuvable ‚ùå");
  }
}

/* === Zoom tactile (iPhone) === */
let currentScale = 1;
let currentTranslate = { x: 0, y: 0 };
let isDragging = false;
let lastTouchDistance = 0;
let lastTouchCenter = null;
let lastTap = 0;

function updateTransform() {
  zoomContainer.style.transform =
    `translate(${currentTranslate.x}px, ${currentTranslate.y}px) scale(${currentScale})`;
}

zoomContainer.addEventListener("touchstart", (e) => {
  const now = Date.now();
  if (now - lastTap < 300 && e.touches.length === 1) {
    currentScale = currentScale === 1 ? 2 : 1;
    updateTransform();
    e.preventDefault();
    return;
  }
  lastTap = now;

  if (e.touches.length === 1) {
    isDragging = true;
    lastTouchCenter = { x: e.touches[0].clientX, y: e.touches[0].clientY };
  } else if (e.touches.length === 2) {
    isDragging = false;
    lastTouchDistance = getTouchDistance(e.touches);
    lastTouchCenter = getTouchCenter(e.touches);
  }
}, { passive: false });

zoomContainer.addEventListener("touchmove", (e) => {
  e.preventDefault();
  if (e.touches.length === 1 && isDragging) {
    const dx = e.touches[0].clientX - lastTouchCenter.x;
    const dy = e.touches[0].clientY - lastTouchCenter.y;
    lastTouchCenter = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    currentTranslate.x += dx;
    currentTranslate.y += dy;
    updateTransform();
  } else if (e.touches.length === 2) {
    const newDistance = getTouchDistance(e.touches);
    const scaleChange = newDistance / lastTouchDistance;
    currentScale = Math.min(Math.max(currentScale * scaleChange, 0.5), 5);
    lastTouchDistance = newDistance;

    const newCenter = getTouchCenter(e.touches);
    const dx = newCenter.x - lastTouchCenter.x;
    const dy = newCenter.y - lastTouchCenter.y;
    currentTranslate.x += dx;
    currentTranslate.y += dy;
    lastTouchCenter = newCenter;

    updateTransform();
  }
}, { passive: false });

zoomContainer.addEventListener("touchend", () => isDragging = false);

function getTouchDistance(touches) {
  const [t1, t2] = touches;
  return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
}
function getTouchCenter(touches) {
  const [t1, t2] = touches;
  return { x: (t1.clientX + t2.clientX) / 2, y: (t1.clientY + t2.clientY) / 2 };
}
</script>
</body>
</html>
